【テキスト】 オブジェクト指向⑥-2 ～多態性（アップキャスト・引数と戻り値）～
<div style="max-width: 800px; margin: 0 auto; font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; line-height: 1.6; color: #333; padding: 20px; border: 1px solid #eee; background-color: #fff;">
<h1 style="padding-left: 10px; background-color: #f0f8ff; color: #0033ff; font-size: 24px; margin-bottom: 30px;">オブジェクト指向学習カリキュラム</h1>
<p style="margin-bottom: 10px;"><strong>多態性（ポリモーフィズム）②</strong> — アップキャスト・メソッドの引数と戻り値（第14-2回）</p>

<section style="margin-bottom: 30px;">
<h2 style="border-left: 5px solid #0033ff; padding-left: 10px; color: #0033ff; font-size: 18px; margin-bottom: 15px;">この単元の前に：第14-1回の復習</h2>
<p style="margin-bottom: 10px;">第14-1回では、スーパークラス型の配列にいろいろな種類の自販機を入れ、for 文で <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">buy()</code> を呼ぶと、どの機種でもその機種の動きになることを確認しました。今回は、<strong>アップキャスト</strong>の意味をはっきり押さえ、<strong>メソッドの引数や戻り値</strong>でポリモーフィズムをどう使うかを学びます。</p>
</section>

<hr style="border: none; border-top: 1px solid #ccc; margin: 1.5em 0;">

<section style="margin-bottom: 30px;">
<h2 style="border-left: 5px solid #0033ff; padding-left: 10px; color: #0033ff; font-size: 18px; margin-bottom: 15px;">【1】学習目標（第14-2回）</h2>
<ul style="padding-left: 20px; margin: 0;">
<li style="margin-bottom: 10px;">「多態性」とは、同じ型の変数で受けても、実際のインスタンスに応じてメソッドの動きが変わることだと説明できる。</li>
<li style="margin-bottom: 10px;">アップキャスト（サブクラス・実装クラスのインスタンスを、スーパークラス型・インタフェース型の変数に代入する）の書き方を理解する。</li>
<li style="margin-bottom: 10px;">メソッドの<strong>引数</strong>や<strong>戻り値</strong>の型をスーパークラス型・インタフェース型にすると、呼び出し側が「どの具象クラスか」を気にしなくてよくなる利点を理解する。</li>
</ul>
</section>

<hr style="border: none; border-top: 1px solid #ccc; margin: 1.5em 0;">

<section style="margin-bottom: 30px;">
<h2 style="border-left: 5px solid #0033ff; padding-left: 10px; color: #0033ff; font-size: 18px; margin-bottom: 15px;">【2】ポリモーフィズムの復習とアップキャスト</h2>
<div style="background-color: #f2f2f2; padding: 15px; border-radius: 5px; border-left: 5px solid #888888; margin-bottom: 10px;">
<p style="margin: 0;"><strong>カバ先生：</strong>「抽象クラスやインタフェースは、『このメソッドを必ず持ってね』という型の決まりでしたね。その<strong>型の変数</strong>に、いろいろな具象クラスのインスタンスを入れて、同じメソッド名を呼ぶと、<strong>実際に入っているインスタンスの側</strong>のメソッドが動く。これを<strong>多態性（ポリモーフィズム）</strong>といいます。」</p>
</div>
<div style="background-color: #e6f4ff; padding: 15px; border-radius: 5px; border-left: 5px solid #4da6ff;">
<p style="margin: 0;"><strong>ユウタ：</strong>「変数の型は同じなのに、中身が温麺機なら温麺の動き、ガチャ機ならガチャの動きになる、ということですね。」</p>
</div>

<h3 style="padding-left: 10px; color: #0033ff; font-size: 16px; margin-top: 20px; margin-bottom: 10px;">図1：ポリモーフィズムのイメージ</h3>
<p style="margin-bottom: 10px;">同じ型（VendingMachine）の変数 <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">v</code> に、異なるサブクラスのインスタンスを入れると、<code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">v.buy()</code> を呼んだときに<strong>中身に応じて異なる動き</strong>をします。</p>
<!-- 図の差し込み用：例）diagram/ポリモーフィズムのイメージ.png を <img src="diagram/ポリモーフィズムのイメージ.png" alt="ポリモーフィズムのイメージ" style="max-width: 100%; height: auto;"> で挿入 -->
<div style="border: 2px dashed #ccc; min-height: 80px; padding: 15px; text-align: center; color: #888; background-color: #fafafa; border-radius: 8px; margin: 15px 0;">【図の挿入①】図1：ポリモーフィズムのイメージ</div>

<h3 style="padding-left: 10px; color: #0033ff; font-size: 16px; margin-top: 25px; margin-bottom: 10px;">図2：アップキャスト後はスーパークラスのメソッドだけ呼べる</h3>
<p style="margin-bottom: 10px;">アップキャストした変数からは、<strong>その変数の型（スーパークラス・インタフェース）が持っているメソッドだけ</strong>を呼べます。サブクラスだけが持つメソッドは、スーパークラス型の変数からは<strong>呼べません</strong>（コンパイルエラーになります）。</p>
<!-- 図の差し込み用：例）diagram/アップキャストで使えるメソッドの範囲.png を <img> で挿入 -->
<div style="border: 2px dashed #ccc; min-height: 80px; padding: 15px; text-align: center; color: #888; background-color: #fafafa; border-radius: 8px; margin: 15px 0;">【図の挿入②】図2：アップキャスト後はスーパークラスのメソッドだけ呼べる</div>

<h3 style="padding-left: 10px; color: #0033ff; font-size: 16px; margin-top: 25px; margin-bottom: 10px;">アップキャスト：スーパークラス型・インタフェース型の変数で受ける</h3>
<p style="margin-bottom: 10px;">サブクラスや実装クラスのインスタンスを、スーパークラス型やインタフェース型の変数に代入することを<strong>アップキャスト</strong>といいます。代入後、その変数から呼べるのは、その型が持っているメソッドだけです。ただし、<strong>実際に動くのは、中身のインスタンスがオーバーライド（実装）したメソッド</strong>です。</p>
<p style="margin-bottom: 10px;">例：<code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">VendingMachine v = new VendingHotNoodle();</code> のあと <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">v.buy();</code> を呼ぶと、VendingHotNoodle の <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">buy()</code> が実行され、温麺の購入メッセージと「2分待つ」「お湯を注ぐ」が表示されます。</p>
</section>

<hr style="border: none; border-top: 1px solid #ccc; margin: 1.5em 0;">

<section style="margin-bottom: 30px;">
<h2 style="border-left: 5px solid #0033ff; padding-left: 10px; color: #0033ff; font-size: 18px; margin-bottom: 15px;">【3】メソッドの引数でのポリモーフィズム</h2>
<p style="margin-bottom: 10px;">メソッドの<strong>引数の型</strong>をスーパークラス型やインタフェース型にしておくと、「その型を実装したクラス」なら何を渡してもよい、という設計になります。呼び出し側は「VendingMachine 型の引数に、VendingHotNoodle でも Vending2Items でも VendingHobby でも渡せる」とだけ考えればよく、中身に応じて正しい <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">buy()</code> が動きます。</p>
<pre style="font-family: monospace; background-color: #fdf5e6; color: #333; padding: 15px; border-radius: 5px; border: 1px solid #e1dbbd; overflow-x: auto;"><span style="color: #666;">// 引数が「自販機型」なので、どのサブクラスでも渡せる</span>
<span style="color: #0033ff;">public static void</span> doBuy(VendingMachine vm) {
    vm.buy();   <span style="color: #666;">// 実際に渡されたインスタンスの buy() が動く</span>
}

<span style="color: #666;">// 呼び出し例</span>
doBuy(<span style="color: #0033ff;">new</span> VendingHotNoodle());
doBuy(<span style="color: #0033ff;">new</span> Vending2Items(1));
doBuy(<span style="color: #0033ff;">new</span> VendingHobby());</pre>
<div style="background-color: #ffe6f0; padding: 15px; border-radius: 5px; border-left: 5px solid #e8a0b0;">
<p style="margin: 0;"><strong>ナナコ：</strong>「『自販機を1台受け取って、buy() してね』というメソッドにしておけば、温麺機を渡してもガチャ機を渡しても、同じメソッドで扱えるんですね。」</p>
</div>
</section>

<hr style="border: none; border-top: 1px solid #ccc; margin: 1.5em 0;">

<section style="margin-bottom: 30px;">
<h2 style="border-left: 5px solid #0033ff; padding-left: 10px; color: #0033ff; font-size: 18px; margin-bottom: 15px;">【4】メソッドの戻り値でのポリモーフィズム</h2>
<p style="margin-bottom: 10px;">メソッドの<strong>戻り値の型</strong>をスーパークラス型やインタフェース型にすると、「その型のインスタンスを返す」と宣言できます。中で <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">return new VendingHotNoodle();</code> のようにサブクラスのインスタンスを返しても、受け取る側は <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">VendingMachine</code> 型の変数で受け、<code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">buy()</code> を呼べば、返ってきた実際のインスタンスの <code style="font-family: monospace; background-color: #f5f5f5; padding: 1px 4px; border-radius: 3px;">buy()</code> が動きます。</p>
<pre style="font-family: monospace; background-color: #fdf5e6; color: #333; padding: 15px; border-radius: 5px; border: 1px solid #e1dbbd; overflow-x: auto;"><span style="color: #666;">// 戻り値の型が「自販機型」なので、サブクラスのインスタンスを return してよい</span>
<span style="color: #0033ff;">public static</span> VendingMachine getMachine(<span style="color: #0033ff;">int</span> kind) {
    <span style="color: #0033ff;">if</span> (kind == 0) <span style="color: #0033ff;">return</span> <span style="color: #0033ff;">new</span> VendingHotNoodle();
    <span style="color: #0033ff;">if</span> (kind == 1) <span style="color: #0033ff;">return</span> <span style="color: #0033ff;">new</span> Vending2Items(0);
    <span style="color: #0033ff;">return</span> <span style="color: #0033ff;">new</span> VendingHobby();
}

<span style="color: #666;">// 受け取った側は VendingMachine 型として扱い、buy() を呼べる</span>
VendingMachine m = getMachine(1);
m.buy();   <span style="color: #666;">// Vending2Items の buy() が動く</span></pre>
<div style="background-color: #f2f2f2; padding: 15px; border-radius: 5px; border-left: 5px solid #888888;">
<p style="margin: 0;"><strong>カバ先生：</strong>「引数でも戻り値でも、型を抽象クラスやインタフェースにしておくことで、<strong>実装の差し替え</strong>がしやすくなり、拡張しやすい設計になります。」</p>
</div>
</section>

<hr style="border: none; border-top: 1px solid #ccc; margin: 1.5em 0;">

<section style="margin-bottom: 30px;">
<h2 style="border-left: 5px solid #0033ff; padding-left: 10px; color: #0033ff; font-size: 18px; margin-bottom: 15px;">【5】まとめ（第14-2回・第14回全体）</h2>
<ul style="padding-left: 20px;">
<li style="margin-bottom: 10px;"><strong>多態性（ポリモーフィズム）</strong> — 抽象クラス型やインタフェース型の変数に具象のインスタンスを入れ、同じメソッドを呼ぶと、<strong>実際のインスタンスの側</strong>のメソッドが動く。</li>
<li style="margin-bottom: 10px;"><strong>アップキャスト</strong> — サブクラス・実装クラスのインスタンスを、スーパークラス型・インタフェース型の変数に代入すること。</li>
<li style="margin-bottom: 10px;">メソッドの<strong>引数</strong>や<strong>戻り値</strong>の型をスーパークラス・インタフェースにしておくと、呼び出し側は「型」だけを意識すればよく、実装の差し替えがしやすい。</li>
</ul>
</section>
</div>
